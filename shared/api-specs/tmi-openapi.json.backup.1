{
  "openapi": "3.0.3",
  "info": {
    "title": "TMI (Threat Modeling Improved) API",
    "description": "A RESTful API for collaborative threat modeling with full X6 graph library compatibility. This API provides schemas that align with AntV X6 cell object models for seamless integration with modern diagramming libraries. Supports OAuth 2.0 authentication with client callback integration for seamless single-page application authentication flows.",
    "version": "1.0.0"
  },
  "externalDocs": {
    "description": "Find more information here",
    "url": ""
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "Local development server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token for authenticated requests"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "description": "Represents a user in the system",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Unique identifier for the user",
            "maxLength": 256
          },
          "email": {
            "type": "string",
            "description": "User's email address",
            "maxLength": 256
          },
          "displayName": {
            "type": "string",
            "description": "User's display name",
            "maxLength": 256
          }
        },
        "required": [
          "user_id",
          "email",
          "displayName"
        ]
      }
    },
    "responses": {
      "Error": {
        "description": "Error response",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "examples": {
              "authorizationError": {
                "summary": "Insufficient permissions for sub-resource access",
                "value": {
                  "error": "access_denied",
                  "error_description": "User does not have sufficient permissions to access this sub-resource",
                  "details": {
                    "required_role": "writer",
                    "user_role": "reader",
                    "threat_model_id": "550e8400-e29b-41d4-a716-446655440000",
                    "resource_type": "threat"
                  }
                }
              },
              "notFoundError": {
                "summary": "Sub-resource not found",
                "value": {
                  "error": "not_found",
                  "error_description": "The requested sub-resource does not exist or does not belong to the specified threat model",
                  "details": {
                    "resource_id": "550e8400-e29b-41d4-a716-446655440999",
                    "resource_type": "document",
                    "threat_model_id": "550e8400-e29b-41d4-a716-446655440000"
                  }
                }
              },
              "validationError": {
                "summary": "Invalid input data",
                "value": {
                  "error": "invalid_input",
                  "error_description": "The provided data does not meet validation requirements",
                  "details": {
                    "field_errors": [
                      {
                        "field": "name",
                        "message": "Name is required and cannot be empty"
                      },
                      {
                        "field": "url",
                        "message": "URL must be a valid HTTP/HTTPS URL"
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "paths": {
    "/": {
      "get": {
        "tags": [
          "General"
        ],
        "summary": "Get API information",
        "description": "Returns service, API, and operator information without authentication",
        "operationId": "getApiInfo",
        "responses": {
          "200": {
            "description": "Service and API information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiInfo"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/.well-known/openid-configuration": {
      "get": {
        "tags": [
          "OIDC Discovery"
        ],
        "summary": "OpenID Connect Discovery Configuration",
        "description": "Returns OpenID Connect provider configuration metadata as per RFC 8414",
        "operationId": "getOpenIDConfiguration",
        "responses": {
          "200": {
            "description": "OpenID Connect configuration metadata",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "issuer": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080"
                    },
                    "authorization_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/authorize"
                    },
                    "token_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/token"
                    },
                    "userinfo_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/userinfo"
                    },
                    "jwks_uri": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/.well-known/jwks.json"
                    },
                    "response_types_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "code",
                        "token",
                        "id_token",
                        "code token",
                        "code id_token",
                        "token id_token",
                        "code token id_token"
                      ]
                    },
                    "subject_types_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "public"
                      ]
                    },
                    "id_token_signing_alg_values_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "HS256"
                      ]
                    },
                    "scopes_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "openid",
                        "email",
                        "profile"
                      ]
                    },
                    "claims_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "sub",
                        "email",
                        "email_verified",
                        "name",
                        "given_name",
                        "family_name",
                        "picture",
                        "locale"
                      ]
                    },
                    "introspection_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/introspect"
                    }
                  },
                  "required": [
                    "issuer",
                    "authorization_endpoint",
                    "token_endpoint",
                    "jwks_uri",
                    "response_types_supported",
                    "subject_types_supported",
                    "id_token_signing_alg_values_supported"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/.well-known/oauth-authorization-server": {
      "get": {
        "tags": [
          "OIDC Discovery"
        ],
        "summary": "OAuth 2.0 Authorization Server Metadata",
        "description": "Returns OAuth 2.0 authorization server metadata as per RFC 8414",
        "operationId": "getOAuthAuthorizationServerMetadata",
        "responses": {
          "200": {
            "description": "OAuth 2.0 authorization server metadata",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "issuer": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080"
                    },
                    "authorization_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/authorize"
                    },
                    "token_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/token"
                    },
                    "introspection_endpoint": {
                      "type": "string",
                      "format": "uri",
                      "example": "http://localhost:8080/oauth2/introspect"
                    },
                    "response_types_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "code",
                        "token",
                        "id_token"
                      ]
                    },
                    "grant_types_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "authorization_code",
                        "implicit",
                        "refresh_token"
                      ]
                    },
                    "token_endpoint_auth_methods_supported": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "example": [
                        "client_secret_post",
                        "none"
                      ]
                    }
                  },
                  "required": [
                    "issuer",
                    "authorization_endpoint",
                    "token_endpoint",
                    "response_types_supported"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/.well-known/jwks.json": {
      "get": {
        "tags": [
          "OIDC Discovery"
        ],
        "summary": "JSON Web Key Set",
        "description": "Returns the JSON Web Key Set (JWKS) for JWT signature verification",
        "operationId": "getJWKS",
        "responses": {
          "200": {
            "description": "JSON Web Key Set",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "keys": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "kty": {
                            "type": "string",
                            "example": "oct"
                          },
                          "use": {
                            "type": "string",
                            "example": "sig"
                          },
                          "alg": {
                            "type": "string",
                            "example": "HS256"
                          },
                          "kid": {
                            "type": "string",
                            "example": "tmi-signing-key"
                          }
                        },
                        "required": [
                          "kty",
                          "use",
                          "alg",
                          "kid"
                        ]
                      }
                    }
                  },
                  "required": [
                    "keys"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/oauth2/introspect": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Token Introspection",
        "description": "Introspects a JWT token to determine its validity and metadata as per RFC 7662",
        "operationId": "introspectToken",
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "The JWT token to introspect",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  },
                  "token_type_hint": {
                    "type": "string",
                    "description": "Optional hint about the type of token being introspected",
                    "example": "access_token"
                  }
                },
                "required": [
                  "token"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token introspection result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "active": {
                      "type": "boolean",
                      "description": "Whether the token is active/valid",
                      "example": true
                    },
                    "sub": {
                      "type": "string",
                      "description": "Subject (user identifier)",
                      "example": "user@example.com"
                    },
                    "email": {
                      "type": "string",
                      "description": "User email address",
                      "example": "user@example.com"
                    },
                    "email_verified": {
                      "type": "boolean",
                      "description": "Whether the email is verified",
                      "example": true
                    },
                    "name": {
                      "type": "string",
                      "description": "User's full name",
                      "example": "John Doe"
                    },
                    "exp": {
                      "type": "integer",
                      "description": "Token expiration time (Unix timestamp)",
                      "example": 1640995200
                    },
                    "iat": {
                      "type": "integer",
                      "description": "Token issued at time (Unix timestamp)",
                      "example": 1640991600
                    },
                    "iss": {
                      "type": "string",
                      "description": "Token issuer",
                      "example": "http://localhost:8080"
                    }
                  },
                  "required": [
                    "active"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/oauth2/providers": {
      "get": {
        "tags": [
          "Authentication"
        ],
        "summary": "List available OAuth providers",
        "description": "Returns a list of configured OAuth providers available for authentication",
        "operationId": "getAuthProviders",
        "responses": {
          "200": {
            "description": "List of available OAuth providers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "providers": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "Provider identifier"
                          },
                          "name": {
                            "type": "string",
                            "description": "Display name of the provider"
                          },
                          "icon": {
                            "type": "string",
                            "description": "Icon identifier for the provider"
                          },
                          "auth_url": {
                            "type": "string",
                            "format": "uri",
                            "description": "TMI authorization endpoint URL for this provider"
                          },
                          "redirect_uri": {
                            "type": "string",
                            "format": "uri",
                            "description": "OAuth callback URI configured for this provider"
                          },
                          "client_id": {
                            "type": "string",
                            "description": "OAuth client ID for this provider"
                          }
                        },
                        "required": [
                          "id",
                          "name",
                          "icon",
                          "auth_url",
                          "redirect_uri",
                          "client_id"
                        ]
                      }
                    }
                  },
                  "required": [
                    "providers"
                  ]
                },
                "example": {
                  "providers": [
                    {
                      "id": "google",
                      "name": "Google",
                      "icon": "fa-brands fa-google",
                      "auth_url": "http://localhost:8080/oauth2/authorize?idp=google",
                      "redirect_uri": "http://localhost:8080/oauth2/callback",
                      "client_id": "675196260523-e8ppeu62pv222jhnpebe929b2tgl2jm0.apps.googleusercontent.com"
                    },
                    {
                      "id": "github",
                      "name": "GitHub",
                      "icon": "fa-brands fa-github",
                      "auth_url": "http://localhost:8080/oauth2/authorize?idp=github",
                      "redirect_uri": "http://localhost:8080/oauth2/callback",
                      "client_id": "your-github-client-id"
                    },
                    {
                      "id": "microsoft",
                      "name": "Microsoft",
                      "icon": "fa-brands fa-microsoft",
                      "auth_url": "http://localhost:8080/oauth2/authorize?idp=microsoft",
                      "redirect_uri": "http://localhost:8080/oauth2/callback",
                      "client_id": "your-microsoft-client-id"
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/oauth2/authorize": {
      "get": {
        "tags": [
          "Authentication"
        ],
        "summary": "Initiate OAuth authorization flow",
        "description": "Redirects user to OAuth provider's authorization page. Supports client callback URL for seamless client integration. Generates state parameter for CSRF protection.",
        "operationId": "authorizeOAuthProvider",
        "parameters": [
          {
            "name": "idp",
            "in": "query",
            "required": false,
            "description": "OAuth provider identifier. Defaults to 'test' provider in non-production builds if not specified.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "client_callback",
            "in": "query",
            "required": false,
            "description": "Client callback URL where TMI should redirect after successful OAuth completion with tokens as query parameters. If not provided, tokens are returned as JSON response.",
            "schema": {
              "type": "string",
              "format": "uri",
              "example": "http://localhost:4200/oauth2/callback"
            }
          },
          {
            "name": "state",
            "in": "query",
            "required": false,
            "description": "CSRF protection state parameter. Recommended for security. Will be included in the callback response.",
            "schema": {
              "type": "string",
              "example": "random_state_abc123"
            }
          },
          {
            "name": "login_hint",
            "in": "query",
            "required": false,
            "description": "User identity hint for test OAuth provider. Allows specifying a desired user identity for testing and automation. Only supported by the test provider (ignored by production providers like Google, GitHub, etc.). Must be 3-20 characters, alphanumeric and hyphens only.",
            "schema": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9-]{3,20}$",
              "example": "alice"
            }
          },
          {
            "name": "scope",
            "in": "query",
            "required": true,
            "description": "OAuth 2.0 scope parameter. For OpenID Connect, must include \"openid\". Supports \"profile\" and \"email\" scopes. Other scopes are silently ignored. Space-separated values.",
            "schema": {
              "type": "string",
              "example": "openid profile email"
            }
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to OAuth provider authorization page",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "OAuth provider authorization URL with client_id, redirect_uri, response_type, scope, and state parameters"
              }
            }
          },
          "400": {
            "description": "Invalid provider or provider not configured",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error generating authorization URL",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/oauth2/token": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Exchange OAuth authorization code for JWT tokens",
        "description": "Provider-neutral endpoint to exchange OAuth authorization codes for TMI JWT tokens. Supports Google, GitHub, and Microsoft OAuth providers.",
        "operationId": "exchangeOAuthCode",
        "parameters": [
          {
            "name": "idp",
            "in": "query",
            "required": false,
            "description": "OAuth provider identifier. Defaults to 'test' provider in non-production builds if not specified.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "Authorization code received from OAuth provider",
                    "example": "4/0AX4XfWiXY2BZ_example_auth_code_from_google"
                  },
                  "state": {
                    "type": "string",
                    "description": "State parameter for CSRF protection (optional but recommended)",
                    "example": "random_state_value_abc123"
                  },
                  "redirect_uri": {
                    "type": "string",
                    "format": "uri",
                    "description": "Redirect URI used in the authorization request (must match exactly)",
                    "example": "https://your-web-app.com/oauth2/callback"
                  }
                },
                "required": [
                  "code",
                  "redirect_uri"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OAuth exchange successful, TMI JWT tokens issued",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthTokenResponse"
                },
                "example": {
                  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyQGV4YW1wbGUuY29tIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyNDI2MjJ9.example_jwt_signature",
                  "refresh_token": "8xLOxBtZp8_example_refresh_token",
                  "token_type": "Bearer",
                  "expires_in": 3600
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid provider, missing parameters, or invalid state",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "invalid_provider": {
                    "summary": "Invalid provider",
                    "value": {
                      "error": "Invalid provider: invalid_provider",
                      "error_description": "Provider 'invalid_provider' is not configured or supported"
                    }
                  },
                  "missing_code": {
                    "summary": "Missing authorization code",
                    "value": {
                      "error": "Invalid request: missing required fields",
                      "error_description": "The 'code' parameter is required"
                    }
                  },
                  "invalid_state": {
                    "summary": "Invalid state parameter",
                    "value": {
                      "error": "Invalid state parameter",
                      "error_description": "State parameter validation failed - possible CSRF attack"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error - OAuth provider communication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "provider_error": {
                    "summary": "OAuth provider communication failed",
                    "value": {
                      "error": "Failed to exchange authorization code: oauth2: cannot fetch token: 400 Bad Request",
                      "error_description": "Unable to communicate with OAuth provider or invalid authorization code"
                    }
                  },
                  "user_info_error": {
                    "summary": "Failed to get user information",
                    "value": {
                      "error": "Failed to get user info: 401 Unauthorized",
                      "error_description": "OAuth provider denied access to user information"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/oauth2/refresh": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Refresh JWT token",
        "description": "Exchanges a refresh token for a new JWT access token",
        "operationId": "refreshToken",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refresh_token": {
                    "type": "string",
                    "description": "Valid refresh token",
                    "example": "8xLOxBtZp8_example_refresh_token"
                  }
                },
                "required": [
                  "refresh_token"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "New JWT issued successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthTokenResponse"
                },
                "example": {
                  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyQGV4YW1wbGUuY29tIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyNDI2MjJ9.new_jwt_signature",
                  "refresh_token": "9yMPyCtZq9_new_refresh_token",
                  "token_type": "Bearer",
                  "expires_in": 3600
                }
              }
            }
          },
          "400": {
            "description": "Bad request - missing or invalid refresh token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missing_token": {
                    "summary": "Missing refresh token",
                    "value": {
                      "error": "Invalid request: missing required fields",
                      "error_description": "The 'refresh_token' parameter is required"
                    }
                  },
                  "invalid_format": {
                    "summary": "Invalid token format",
                    "value": {
                      "error": "Invalid refresh token format",
                      "error_description": "Refresh token must be a valid UUID string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or expired refresh token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "expired_token": {
                    "summary": "Expired refresh token",
                    "value": {
                      "error": "Invalid refresh token",
                      "error_description": "The refresh token has expired or has been revoked"
                    }
                  },
                  "invalid_token": {
                    "summary": "Invalid refresh token",
                    "value": {
                      "error": "Invalid refresh token",
                      "error_description": "The provided refresh token is not valid"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/oauth2/userinfo": {
      "get": {
        "tags": [
          "Authentication"
        ],
        "summary": "Get current user information",
        "description": "Returns information about the currently authenticated user",
        "operationId": "getCurrentUser",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Current user information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid",
                      "description": "Unique identifier for the user (UUID)",
                      "maxLength": 36
                    },
                    "email": {
                      "type": "string",
                      "format": "email",
                      "description": "User email address"
                    },
                    "name": {
                      "type": "string",
                      "description": "User display name"
                    },
                    "providers": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "provider": {
                            "type": "string",
                            "description": "OAuth provider name"
                          },
                          "is_primary": {
                            "type": "boolean",
                            "description": "Whether this is the primary authentication method"
                          }
                        }
                      },
                      "description": "Linked OAuth providers"
                    }
                  },
                  "required": [
                    "id",
                    "email",
                    "name"
                  ]
                },
                "example": {
                  "id": "550e8400-e29b-41d4-a716-446655440000",
                  "email": "user@example.com",
                  "name": "John Doe",
                  "providers": [
                    {
                      "provider": "google",
                      "is_primary": true
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/oauth2/callback": {
      "get": {
        "tags": [
          "Authentication"
        ],
        "summary": "Handle OAuth callback",
        "description": "Exchanges OAuth authorization code for JWT tokens. If client_callback was provided during authorization, redirects to client with tokens. Otherwise returns tokens as JSON response.",
        "operationId": "handleOAuthCallback",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Authorization code from the OAuth provider"
          },
          {
            "name": "state",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Optional state parameter for CSRF protection"
          }
        ],
        "responses": {
          "200": {
            "description": "JWT tokens issued successfully (legacy mode when no client_callback provided)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthTokenResponse"
                }
              }
            }
          },
          "302": {
            "description": "Redirect to client callback URL with tokens (when client_callback was provided)",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "format": "uri",
                  "example": "http://localhost:4200/oauth2/callback?access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&expires_in=3600&token_type=Bearer&state=random_state_abc123"
                },
                "description": "Client callback URL with access_token, refresh_token, expires_in, token_type, and state as query parameters"
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/oauth2/revoke": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Logout user",
        "description": "Invalidates the user's JWT token by adding it to a blacklist, effectively ending the session. Once logged out, the token cannot be used for further authenticated requests until it naturally expires. The token blacklist is maintained in Redis with automatic cleanup based on token expiration times.",
        "operationId": "logoutUser",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "description": "Empty request body - token is provided via Authorization header",
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {},
                "example": {}
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "User logged out successfully. The JWT token has been invalidated and added to the blacklist.",
            "headers": {
              "X-Request-ID": {
                "description": "Unique request identifier for tracking",
                "schema": {
                  "type": "string",
                  "example": "req_abc123def456"
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed - invalid, missing, or malformed token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "examples": {
                  "missing_token": {
                    "summary": "Missing Authorization header",
                    "value": {
                      "error": "unauthorized",
                      "error_description": "Missing Authorization header"
                    }
                  },
                  "invalid_format": {
                    "summary": "Invalid Authorization header format",
                    "value": {
                      "error": "unauthorized",
                      "error_description": "Invalid Authorization header format"
                    }
                  },
                  "malformed_token": {
                    "summary": "Malformed JWT token",
                    "value": {
                      "error": "unauthorized",
                      "error_description": "Invalid token format"
                    }
                  },
                  "blacklisted_token": {
                    "summary": "Token already blacklisted",
                    "value": {
                      "error": "unauthorized",
                      "error_description": "Token has been revoked"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error - token blacklisting failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/collaboration/sessions": {
      "get": {
        "tags": [
          "Collaboration"
        ],
        "summary": "List active collaboration sessions",
        "description": "Returns all currently active collaboration sessions for diagrams. Clients can use this endpoint to discover existing sessions before connecting via WebSocket.",
        "operationId": "getCollaborationSessions",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of active collaboration sessions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/CollaborationSession"
                  }
                },
                "examples": {
                  "active_sessions": {
                    "summary": "Multiple active sessions",
                    "value": [
                      {
                        "diagram_id": "123e4567-e89b-12d3-a456-426614174000",
                        "participants": [
                          {
                            "user_id": "alice@example.com"
                          },
                          {
                            "user_id": "bob@example.com"
                          }
                        ]
                      }
                    ]
                  },
                  "no_sessions": {
                    "summary": "No active sessions",
                    "value": []
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed - invalid, missing, or malformed token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/threat_models": {
      "get": {
        "tags": [
          "Threat Models"
        ],
        "summary": "List threat models",
        "description": "Returns a list of threat models accessible to the authenticated user with enhanced metadata and entity counts",
        "operationId": "listThreatModels",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "Number of threat models to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 0
            },
            "description": "Pagination offset"
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "default": "created_at:desc"
            },
            "description": "Sort order (e.g., created_at:desc, name:asc)"
          },
          {
            "name": "owner",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by owner username or email"
          },
          {
            "name": "name",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by threat model name (partial match)"
          },
          {
            "name": "description",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by threat model description (partial match)"
          },
          {
            "name": "issue_url",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by issue URL (partial match)"
          },
          {
            "name": "created_after",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter threat models created after this date (RFC3339 format)"
          },
          {
            "name": "created_before",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter threat models created before this date (RFC3339 format)"
          },
          {
            "name": "modified_after",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter threat models modified after this date (RFC3339 format)"
          },
          {
            "name": "modified_before",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter threat models modified before this date (RFC3339 format)"
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated list of threat models with enhanced metadata and entity counts",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/PaginatedResponse"
                    },
                    {
                      "properties": {
                        "data": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/TMListItem"
                          }
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "data": [
                    {
                      "id": "550e8400-e29b-41d4-a716-446655440000",
                      "name": "System Threat Model",
                      "description": "Comprehensive threat model for our web application system",
                      "created_at": "2025-04-06T12:00:00Z",
                      "modified_at": "2025-04-06T14:30:00Z",
                      "owner": "user@example.com",
                      "created_by": "admin@example.com",
                      "threat_model_framework": "STRIDE",
                      "issue_url": "https://github.com/example/issues/123",
                      "document_count": 3,
                      "source_count": 2,
                      "diagram_count": 1,
                      "threat_count": 15
                    }
                  ],
                  "pagination": {
                    "total": 1,
                    "limit": 20,
                    "offset": 0,
                    "has_more": false
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Models"
        ],
        "summary": "Create a threat model",
        "description": "Creates a new threat model with the authenticated user as owner",
        "operationId": "createThreatModel",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreatModelInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Threat model created successfully",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string"
                },
                "description": "URL of the new threat model"
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreatModel"
                },
                "example": {
                  "id": "550e8400-e29b-41d4-a716-446655440000",
                  "name": "System Threat Model",
                  "description": "Threats for system X",
                  "created_at": "2025-04-06T12:00:00Z",
                  "modified_at": "2025-04-06T12:00:00Z",
                  "owner": "user@example.com",
                  "created_by": "user@example.com",
                  "threat_model_framework": "STRIDE",
                  "authorization": [
                    {
                      "subject": "user@example.com",
                      "role": "owner"
                    }
                  ],
                  "metadata": [],
                  "documents": [],
                  "sourceCode": [],
                  "diagrams": [],
                  "threats": []
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}": {
      "get": {
        "tags": [
          "Threat Models"
        ],
        "summary": "Retrieve a threat model",
        "description": "Retrieves the full details of a specific threat model if the user has access",
        "operationId": "getThreatModel",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model to retrieve (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Full threat model details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreatModel"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Models"
        ],
        "summary": "Update a threat model",
        "description": "Fully updates a threat model; restricted to writer/owner roles",
        "operationId": "updateThreatModel",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model to update (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreatModelInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threat model updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreatModel"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "patch": {
        "tags": [
          "Threat Models"
        ],
        "summary": "Partially update a threat model",
        "description": "Applies JSON Patch operations to a threat model; restricted to writer/owner roles",
        "operationId": "patchThreatModel",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model to update (UUID)"
          }
        ],
        "requestBody": {
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "op": {
                      "type": "string",
                      "enum": [
                        "add",
                        "replace",
                        "remove",
                        "move",
                        "copy",
                        "test"
                      ],
                      "description": "Patch operation type"
                    },
                    "path": {
                      "type": "string",
                      "description": "JSON path to target"
                    },
                    "value": {
                      "description": "Value to apply"
                    }
                  },
                  "required": [
                    "op",
                    "path"
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threat model updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreatModel"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Models"
        ],
        "summary": "Delete a threat model",
        "description": "Deletes a threat model; restricted to owner role",
        "operationId": "deleteThreatModel",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model to delete (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Threat model deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "List threats in a threat model",
        "description": "Returns a paginated list of threats within the specified threat model",
        "operationId": "getThreatModelThreats",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Maximum number of threats to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of threats to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "List of threats",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "threats": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Threat"
                      }
                    },
                    "total_count": {
                      "type": "integer",
                      "description": "Total number of threats in the threat model"
                    }
                  },
                  "required": [
                    "threats",
                    "total_count"
                  ]
                },
                "examples": {
                  "threatList": {
                    "summary": "List of threats with metadata",
                    "value": {
                      "threats": [
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440003",
                          "name": "SQL Injection Vulnerability",
                          "description": "Database injection through malicious SQL queries",
                          "severity": "High",
                          "priority": "urgent",
                          "status": "active",
                          "mitigated": false,
                          "threat_model_id": "550e8400-e29b-41d4-a716-446655440000",
                          "created_at": "2025-01-15T10:30:00Z",
                          "modified_at": "2025-01-15T14:45:00Z",
                          "metadata": [
                            {
                              "key": "category",
                              "value": "data_validation"
                            },
                            {
                              "key": "owasp_top_10",
                              "value": "A03"
                            },
                            {
                              "key": "assigned_to",
                              "value": "security-team"
                            }
                          ]
                        },
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440004",
                          "name": "Cross-Site Scripting (XSS)",
                          "description": "Client-side script injection vulnerability",
                          "severity": "Medium",
                          "priority": "medium",
                          "status": "identified",
                          "mitigated": false,
                          "threat_model_id": "550e8400-e29b-41d4-a716-446655440000",
                          "created_at": "2025-01-15T11:00:00Z",
                          "modified_at": "2025-01-15T11:00:00Z",
                          "metadata": [
                            {
                              "key": "category",
                              "value": "input_validation"
                            },
                            {
                              "key": "owasp_top_10",
                              "value": "A07"
                            }
                          ]
                        }
                      ],
                      "total_count": 12
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create a new threat",
        "description": "Creates a new threat within the specified threat model",
        "operationId": "createThreatModelThreat",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreatInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Threat created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Threat"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/{threat_id}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get a specific threat",
        "description": "Returns details of a specific threat within the threat model",
        "operationId": "getThreatModelThreat",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Threat details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Threat"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update a threat",
        "description": "Updates a specific threat within the threat model",
        "operationId": "updateThreatModelThreat",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreatInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threat updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Threat"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "patch": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Partially update a threat",
        "description": "Applies JSON patch operations to a specific threat within the threat model",
        "operationId": "patchThreatModelThreat",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "op": {
                      "type": "string",
                      "enum": [
                        "add",
                        "remove",
                        "replace",
                        "move",
                        "copy",
                        "test"
                      ]
                    },
                    "path": {
                      "type": "string"
                    },
                    "value": {},
                    "from": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "op",
                    "path"
                  ]
                }
              },
              "examples": {
                "updateThreatDetails": {
                  "summary": "Update threat name and severity",
                  "value": [
                    {
                      "op": "replace",
                      "path": "/name",
                      "value": "Updated SQL Injection Threat"
                    },
                    {
                      "op": "replace",
                      "path": "/severity",
                      "value": "Critical"
                    },
                    {
                      "op": "replace",
                      "path": "/description",
                      "value": "Updated description with more details"
                    }
                  ]
                },
                "addMetadata": {
                  "summary": "Add metadata to a threat",
                  "value": [
                    {
                      "op": "add",
                      "path": "/metadata/-",
                      "value": {
                        "key": "priority",
                        "value": "urgent"
                      }
                    },
                    {
                      "op": "add",
                      "path": "/metadata/-",
                      "value": {
                        "key": "assigned_to",
                        "value": "security-team"
                      }
                    }
                  ]
                },
                "updateStatus": {
                  "summary": "Update threat status and mitigation",
                  "value": [
                    {
                      "op": "replace",
                      "path": "/status",
                      "value": "mitigated"
                    },
                    {
                      "op": "replace",
                      "path": "/mitigated",
                      "value": true
                    },
                    {
                      "op": "replace",
                      "path": "/mitigation",
                      "value": "Implemented input validation and parameterized queries"
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threat patched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Threat"
                },
                "examples": {
                  "patchedThreat": {
                    "summary": "Successfully patched threat with updated fields",
                    "value": {
                      "id": "550e8400-e29b-41d4-a716-446655440003",
                      "name": "Updated SQL Injection Threat",
                      "description": "Updated description with more details",
                      "severity": "Critical",
                      "priority": "urgent",
                      "status": "active",
                      "mitigated": false,
                      "threat_model_id": "550e8400-e29b-41d4-a716-446655440000",
                      "created_at": "2025-01-15T10:30:00Z",
                      "modified_at": "2025-01-15T14:45:00Z",
                      "metadata": [
                        {
                          "key": "priority",
                          "value": "urgent"
                        },
                        {
                          "key": "assigned_to",
                          "value": "security-team"
                        },
                        {
                          "key": "cve_reference",
                          "value": "CVE-2024-1234"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete a threat",
        "description": "Deletes a specific threat from the threat model",
        "operationId": "deleteThreatModelThreat",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Threat deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/{threat_id}/metadata": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get threat metadata",
        "description": "Returns all metadata key-value pairs for the specified threat",
        "operationId": "getThreatMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Threat metadata list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create threat metadata",
        "description": "Creates new metadata entry for the specified threat",
        "operationId": "createThreatMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Metadata"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entry created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/{threat_id}/metadata/{key}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get threat metadata by key",
        "description": "Returns a specific metadata entry by key for the specified threat",
        "operationId": "getThreatMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata entry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update threat metadata by key",
        "description": "Updates a specific metadata entry by key for the specified threat",
        "operationId": "updateThreatMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string",
                    "description": "New value for the metadata entry"
                  }
                },
                "required": [
                  "value"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata entry updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete threat metadata by key",
        "description": "Deletes a specific metadata entry by key for the specified threat",
        "operationId": "deleteThreatMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to delete"
          }
        ],
        "responses": {
          "204": {
            "description": "Metadata entry deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/{threat_id}/metadata/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create threat metadata",
        "description": "Creates multiple metadata entries in a single operation for the specified threat",
        "operationId": "bulkCreateThreatMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Metadata"
                },
                "maxItems": 20
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entries created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create threats",
        "description": "Creates multiple threats in a single operation for the specified threat model",
        "operationId": "bulkCreateThreatModelThreats",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Threat"
                },
                "maxItems": 20,
                "description": "Array of threats to create"
              },
              "examples": {
                "bulkCreateThreats": {
                  "summary": "Create multiple threats at once",
                  "value": [
                    {
                      "name": "SQL Injection Attack",
                      "description": "Attacker injects malicious SQL code through user input",
                      "impact": "High",
                      "likelihood": "Medium",
                      "risk_rating": "High",
                      "metadata": [
                        {
                          "key": "category",
                          "value": "injection"
                        },
                        {
                          "key": "stride",
                          "value": "tampering"
                        }
                      ]
                    },
                    {
                      "name": "Cross-Site Scripting (XSS)",
                      "description": "Malicious scripts executed in user's browser",
                      "impact": "Medium",
                      "likelihood": "High",
                      "risk_rating": "High",
                      "metadata": [
                        {
                          "key": "category",
                          "value": "xss"
                        },
                        {
                          "key": "stride",
                          "value": "tampering"
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Threats created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Threat"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk update threats",
        "description": "Updates multiple threats in a single operation for the specified threat model",
        "operationId": "bulkUpdateThreatModelThreats",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Threat"
                },
                "maxItems": 20,
                "description": "Array of threats to update (must include id field)"
              },
              "examples": {
                "bulkUpdateThreats": {
                  "summary": "Update multiple threats at once",
                  "value": [
                    {
                      "id": "750e8400-e29b-41d4-a716-446655440001",
                      "name": "Updated SQL Injection Attack",
                      "description": "Updated description for SQL injection vulnerability",
                      "impact": "High",
                      "likelihood": "Low",
                      "risk_rating": "Medium",
                      "metadata": [
                        {
                          "key": "category",
                          "value": "injection"
                        },
                        {
                          "key": "mitigation",
                          "value": "parameterized-queries"
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threats updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Threat"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/batch/patch": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Batch patch threats",
        "description": "Applies JSON Patch operations to multiple threats in a single operation",
        "operationId": "batchPatchThreatModelThreats",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "object",
                "properties": {
                  "patches": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "threat_id": {
                          "type": "string",
                          "format": "uuid",
                          "description": "ID of the threat to patch"
                        },
                        "operations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "op": {
                                "type": "string",
                                "enum": [
                                  "add",
                                  "replace",
                                  "remove",
                                  "move",
                                  "copy",
                                  "test"
                                ],
                                "description": "Patch operation type"
                              },
                              "path": {
                                "type": "string",
                                "description": "JSON path to target"
                              },
                              "value": {
                                "description": "Value to apply"
                              }
                            },
                            "required": [
                              "op",
                              "path"
                            ]
                          }
                        }
                      },
                      "required": [
                        "threat_id",
                        "operations"
                      ]
                    },
                    "maxItems": 10
                  }
                },
                "required": [
                  "patches"
                ]
              },
              "examples": {
                "batchPatchThreats": {
                  "summary": "Patch multiple threats with different operations",
                  "value": {
                    "patches": [
                      {
                        "threat_id": "750e8400-e29b-41d4-a716-446655440001",
                        "operations": [
                          {
                            "op": "replace",
                            "path": "/risk_rating",
                            "value": "Medium"
                          },
                          {
                            "op": "replace",
                            "path": "/likelihood",
                            "value": "Low"
                          }
                        ]
                      },
                      {
                        "threat_id": "750e8400-e29b-41d4-a716-446655440002",
                        "operations": [
                          {
                            "op": "add",
                            "path": "/metadata/-",
                            "value": {
                              "key": "reviewed",
                              "value": "true"
                            }
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Threats patched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Threat"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/threats/batch": {
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Batch delete threats",
        "description": "Deletes multiple threats in a single operation for the specified threat model",
        "operationId": "batchDeleteThreatModelThreats",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "threat_ids",
            "in": "query",
            "required": true,
            "style": "form",
            "explode": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "uuid"
              },
              "maxItems": 20,
              "minItems": 1
            },
            "description": "Comma-separated list of threat IDs to delete (e.g., id1,id2,id3)"
          }
        ],
        "responses": {
          "200": {
            "description": "Threats deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "deleted_count": {
                      "type": "integer",
                      "description": "Number of threats successfully deleted"
                    },
                    "deleted_ids": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "description": "Array of successfully deleted threat IDs"
                    }
                  },
                  "required": [
                    "deleted_count",
                    "deleted_ids"
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "List documents in a threat model",
        "description": "Returns a paginated list of documents within the specified threat model",
        "operationId": "getThreatModelDocuments",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Maximum number of documents to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of documents to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "List of documents",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Document"
                      }
                    },
                    "total_count": {
                      "type": "integer",
                      "description": "Total number of documents in the threat model"
                    }
                  },
                  "required": [
                    "documents",
                    "total_count"
                  ]
                },
                "examples": {
                  "documentList": {
                    "summary": "List of documents with pagination",
                    "value": {
                      "documents": [
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440001",
                          "name": "Security Requirements Document",
                          "url": "https://docs.company.com/security-requirements.pdf",
                          "description": "Detailed security requirements and compliance standards",
                          "metadata": [
                            {
                              "key": "classification",
                              "value": "internal"
                            },
                            {
                              "key": "version",
                              "value": "1.2"
                            }
                          ]
                        },
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440002",
                          "name": "Architecture Design Document",
                          "url": "https://docs.company.com/architecture-design.pdf",
                          "description": "System architecture and design specifications",
                          "metadata": [
                            {
                              "key": "classification",
                              "value": "internal"
                            },
                            {
                              "key": "version",
                              "value": "2.0"
                            }
                          ]
                        }
                      ],
                      "total_count": 5
                    }
                  },
                  "emptyList": {
                    "summary": "Empty document list",
                    "value": {
                      "documents": [],
                      "total_count": 0
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create a new document",
        "description": "Creates a new document within the specified threat model",
        "operationId": "createThreatModelDocument",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Document"
              },
              "examples": {
                "createDocument": {
                  "summary": "Create a new security document",
                  "value": {
                    "name": "Security Requirements Document",
                    "url": "https://docs.company.com/security-requirements.pdf",
                    "description": "Detailed security requirements and compliance standards",
                    "metadata": [
                      {
                        "key": "classification",
                        "value": "internal"
                      },
                      {
                        "key": "version",
                        "value": "1.0"
                      },
                      {
                        "key": "owner",
                        "value": "security-team"
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Document created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Document"
                },
                "examples": {
                  "createdDocument": {
                    "summary": "Successfully created document with generated ID",
                    "value": {
                      "id": "550e8400-e29b-41d4-a716-446655440001",
                      "name": "Security Requirements Document",
                      "url": "https://docs.company.com/security-requirements.pdf",
                      "description": "Detailed security requirements and compliance standards",
                      "metadata": [
                        {
                          "key": "classification",
                          "value": "internal"
                        },
                        {
                          "key": "version",
                          "value": "1.0"
                        },
                        {
                          "key": "owner",
                          "value": "security-team"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents/{document_id}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get a specific document",
        "description": "Returns details of a specific document within the threat model",
        "operationId": "getThreatModelDocument",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Document details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Document"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update a document",
        "description": "Updates a specific document within the threat model",
        "operationId": "updateThreatModelDocument",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Document"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Document"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete a document",
        "description": "Deletes a specific document from the threat model",
        "operationId": "deleteThreatModelDocument",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Document deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents/{document_id}/metadata": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get document metadata",
        "description": "Returns all metadata key-value pairs for the specified document",
        "operationId": "getDocumentMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Document metadata list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create document metadata",
        "description": "Creates new metadata entry for the specified document",
        "operationId": "createDocumentMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Metadata"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entry created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents/{document_id}/metadata/{key}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get document metadata by key",
        "description": "Returns a specific metadata entry by key for the specified document",
        "operationId": "getDocumentMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata entry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update document metadata by key",
        "description": "Updates a specific metadata entry by key for the specified document",
        "operationId": "updateDocumentMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string",
                    "description": "New value for the metadata entry"
                  }
                },
                "required": [
                  "value"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata entry updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete document metadata by key",
        "description": "Deletes a specific metadata entry by key for the specified document",
        "operationId": "deleteDocumentMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to delete"
          }
        ],
        "responses": {
          "204": {
            "description": "Metadata entry deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents/{document_id}/metadata/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create document metadata",
        "description": "Creates multiple metadata entries in a single operation for the specified document",
        "operationId": "bulkCreateDocumentMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the document (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Metadata"
                },
                "maxItems": 20
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entries created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/documents/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create documents",
        "description": "Creates multiple documents in a single operation for the specified threat model",
        "operationId": "bulkCreateThreatModelDocuments",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Document"
                },
                "maxItems": 20,
                "description": "Array of documents to create"
              },
              "examples": {
                "bulkCreateDocuments": {
                  "summary": "Create multiple documents at once",
                  "value": [
                    {
                      "name": "Architecture Document",
                      "url": "https://docs.company.com/architecture.pdf",
                      "description": "System architecture documentation",
                      "metadata": [
                        {
                          "key": "type",
                          "value": "architecture"
                        },
                        {
                          "key": "version",
                          "value": "2.1"
                        }
                      ]
                    },
                    {
                      "name": "Security Requirements",
                      "url": "https://docs.company.com/security.pdf",
                      "description": "Security requirements and compliance standards",
                      "metadata": [
                        {
                          "key": "classification",
                          "value": "internal"
                        },
                        {
                          "key": "department",
                          "value": "security"
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Documents created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Document"
                  }
                },
                "examples": {
                  "bulkCreatedDocuments": {
                    "summary": "Successfully created documents with generated IDs",
                    "value": [
                      {
                        "id": "550e8400-e29b-41d4-a716-446655440001",
                        "name": "Architecture Document",
                        "url": "https://docs.company.com/architecture.pdf",
                        "description": "System architecture documentation",
                        "metadata": [
                          {
                            "key": "type",
                            "value": "architecture"
                          },
                          {
                            "key": "version",
                            "value": "2.1"
                          }
                        ],
                        "created_at": "2025-04-06T12:00:00Z",
                        "modified_at": "2025-04-06T12:00:00Z"
                      },
                      {
                        "id": "550e8400-e29b-41d4-a716-446655440002",
                        "name": "Security Requirements",
                        "url": "https://docs.company.com/security.pdf",
                        "description": "Security requirements and compliance standards",
                        "metadata": [
                          {
                            "key": "classification",
                            "value": "internal"
                          },
                          {
                            "key": "department",
                            "value": "security"
                          }
                        ],
                        "created_at": "2025-04-06T12:00:00Z",
                        "modified_at": "2025-04-06T12:00:00Z"
                      }
                    ]
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "List sources in a threat model",
        "description": "Returns a paginated list of source code references within the specified threat model",
        "operationId": "getThreatModelSources",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Maximum number of sources to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of sources to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "List of source code references",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sources": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Source"
                      }
                    },
                    "total_count": {
                      "type": "integer",
                      "description": "Total number of sources in the threat model"
                    }
                  },
                  "required": [
                    "sources",
                    "total_count"
                  ]
                },
                "examples": {
                  "sourceList": {
                    "summary": "List of source code references",
                    "value": {
                      "sources": [
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440010",
                          "name": "Authentication Service",
                          "url": "https://github.com/company/auth-service",
                          "type": "git",
                          "description": "Core authentication and authorization service",
                          "parameters": {
                            "refType": "branch",
                            "refValue": "main"
                          },
                          "metadata": [
                            {
                              "key": "language",
                              "value": "go"
                            },
                            {
                              "key": "coverage",
                              "value": "85%"
                            },
                            {
                              "key": "security_scan",
                              "value": "passed"
                            }
                          ]
                        },
                        {
                          "id": "550e8400-e29b-41d4-a716-446655440011",
                          "name": "Database Layer",
                          "url": "https://github.com/company/db-layer",
                          "type": "git",
                          "description": "Database access layer and ORM implementation",
                          "parameters": {
                            "refType": "tag",
                            "refValue": "v1.2.3"
                          },
                          "metadata": [
                            {
                              "key": "language",
                              "value": "go"
                            },
                            {
                              "key": "database",
                              "value": "postgresql"
                            }
                          ]
                        }
                      ],
                      "total_count": 3
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create a new source reference",
        "description": "Creates a new source code reference within the specified threat model",
        "operationId": "createThreatModelSource",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Source"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Source reference created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Source"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources/{source_id}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get a specific source reference",
        "description": "Returns details of a specific source code reference within the threat model",
        "operationId": "getThreatModelSource",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Source reference details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Source"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update a source reference",
        "description": "Updates a specific source code reference within the threat model",
        "operationId": "updateThreatModelSource",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Source"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Source reference updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Source"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete a source reference",
        "description": "Deletes a specific source code reference from the threat model",
        "operationId": "deleteThreatModelSource",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Source reference deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources/{source_id}/metadata": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get source metadata",
        "description": "Returns all metadata key-value pairs for the specified source reference",
        "operationId": "getSourceMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Source metadata list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create source metadata",
        "description": "Creates new metadata entry for the specified source reference",
        "operationId": "createSourceMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Metadata"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entry created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources/{source_id}/metadata/{key}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get source metadata by key",
        "description": "Returns a specific metadata entry by key for the specified source reference",
        "operationId": "getSourceMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata entry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update source metadata by key",
        "description": "Updates a specific metadata entry by key for the specified source reference",
        "operationId": "updateSourceMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string",
                    "description": "New value for the metadata entry"
                  }
                },
                "required": [
                  "value"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata entry updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete source metadata by key",
        "description": "Deletes a specific metadata entry by key for the specified source reference",
        "operationId": "deleteSourceMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to delete"
          }
        ],
        "responses": {
          "204": {
            "description": "Metadata entry deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources/{source_id}/metadata/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create source metadata",
        "description": "Creates multiple metadata entries in a single operation for the specified source reference",
        "operationId": "bulkCreateSourceMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "source_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the source reference (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Metadata"
                },
                "maxItems": 20
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entries created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/sources/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create sources",
        "description": "Creates multiple source references in a single operation for the specified threat model",
        "operationId": "bulkCreateThreatModelSources",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Source"
                },
                "maxItems": 20,
                "description": "Array of source references to create"
              },
              "examples": {
                "bulkCreateSources": {
                  "summary": "Create multiple source references at once",
                  "value": [
                    {
                      "name": "User Authentication Module",
                      "url": "https://github.com/company/repo/blob/main/oauth2/user.go",
                      "description": "Core user authentication logic",
                      "metadata": [
                        {
                          "key": "language",
                          "value": "go"
                        },
                        {
                          "key": "maintainer",
                          "value": "security-team"
                        }
                      ]
                    },
                    {
                      "name": "Database Connection Pool",
                      "url": "https://github.com/company/repo/blob/main/db/pool.go",
                      "description": "Database connection management",
                      "metadata": [
                        {
                          "key": "type",
                          "value": "infrastructure"
                        },
                        {
                          "key": "criticality",
                          "value": "high"
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Sources created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Source"
                  }
                },
                "examples": {
                  "bulkCreatedSources": {
                    "summary": "Successfully created sources with generated IDs",
                    "value": [
                      {
                        "id": "650e8400-e29b-41d4-a716-446655440001",
                        "name": "User Authentication Module",
                        "url": "https://github.com/company/repo/blob/main/oauth2/user.go",
                        "description": "Core user authentication logic",
                        "metadata": [
                          {
                            "key": "language",
                            "value": "go"
                          },
                          {
                            "key": "maintainer",
                            "value": "security-team"
                          }
                        ],
                        "created_at": "2025-04-06T12:00:00Z",
                        "modified_at": "2025-04-06T12:00:00Z"
                      },
                      {
                        "id": "650e8400-e29b-41d4-a716-446655440002",
                        "name": "Database Connection Pool",
                        "url": "https://github.com/company/repo/blob/main/db/pool.go",
                        "description": "Database connection management",
                        "metadata": [
                          {
                            "key": "type",
                            "value": "infrastructure"
                          },
                          {
                            "key": "criticality",
                            "value": "high"
                          }
                        ],
                        "created_at": "2025-04-06T12:00:00Z",
                        "modified_at": "2025-04-06T12:00:00Z"
                      }
                    ]
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/metadata": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get threat model metadata",
        "description": "Returns all metadata key-value pairs for the specified threat model",
        "operationId": "getThreatModelMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Threat model metadata list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create threat model metadata",
        "description": "Creates new metadata entry for the specified threat model",
        "operationId": "createThreatModelMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Metadata"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entry created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/metadata/{key}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get threat model metadata by key",
        "description": "Returns a specific metadata entry by key for the specified threat model",
        "operationId": "getThreatModelMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata entry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update threat model metadata by key",
        "description": "Updates a specific metadata entry by key for the specified threat model",
        "operationId": "updateThreatModelMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string",
                    "description": "New value for the metadata entry"
                  }
                },
                "required": [
                  "value"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata entry updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete threat model metadata by key",
        "description": "Deletes a specific metadata entry by key for the specified threat model",
        "operationId": "deleteThreatModelMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Metadata key to delete"
          }
        ],
        "responses": {
          "204": {
            "description": "Metadata entry deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/metadata/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create threat model metadata",
        "description": "Creates multiple metadata entries in a single operation for the specified threat model",
        "operationId": "bulkCreateThreatModelMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Metadata"
                },
                "maxItems": 20
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entries created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "List threat model diagrams",
        "description": "Returns all diagrams associated with a specific threat model",
        "operationId": "getThreatModelDiagrams",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Maximum number of items to return"
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "description": "Number of items to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "List of diagrams",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DiagramListItem"
                  }
                },
                "example": [
                  {
                    "id": "123e4567-e89b-12d3-a456-426614174000",
                    "name": "System Architecture Diagram",
                    "type": "DFD-1.0.0"
                  },
                  {
                    "id": "456e7890-e89b-12d3-a456-426614174001",
                    "name": "Data Flow Diagram",
                    "type": "DFD-1.0.0"
                  }
                ]
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create a new diagram",
        "description": "Creates a new diagram within the specified threat model",
        "operationId": "createThreatModelDiagram",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateDiagramRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Diagram created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Diagram"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams/{diagram_id}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get a specific diagram",
        "description": "Retrieves a specific diagram from the threat model",
        "operationId": "getThreatModelDiagram",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Diagram details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Diagram"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update a diagram",
        "description": "Completely replaces a diagram with new data",
        "operationId": "updateThreatModelDiagram",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Diagram"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Diagram updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Diagram"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "patch": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Partially update a diagram",
        "description": "Apply JSON Patch operations to update specific parts of a diagram",
        "operationId": "patchThreatModelDiagram",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json-patch+json": {
              "schema": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "op": {
                      "type": "string",
                      "enum": [
                        "add",
                        "remove",
                        "replace",
                        "move",
                        "copy",
                        "test"
                      ]
                    },
                    "path": {
                      "type": "string"
                    },
                    "value": {},
                    "from": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "op",
                    "path"
                  ]
                }
              },
              "examples": {
                "updateName": {
                  "summary": "Update diagram name",
                  "value": [
                    {
                      "op": "replace",
                      "path": "/name",
                      "value": "Updated Diagram Name"
                    }
                  ]
                },
                "addCell": {
                  "summary": "Add a new cell to the diagram",
                  "value": [
                    {
                      "op": "add",
                      "path": "/cells/-",
                      "value": {
                        "id": "new-cell-id",
                        "shape": "process",
                        "x": 100,
                        "y": 100,
                        "width": 120,
                        "height": 60,
                        "label": "New Process"
                      }
                    }
                  ]
                },
                "addMetadata": {
                  "summary": "Add metadata to diagram",
                  "value": [
                    {
                      "op": "add",
                      "path": "/metadata/-",
                      "value": {
                        "key": "version",
                        "value": "2.0"
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Diagram updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Diagram"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "422": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete a diagram",
        "description": "Permanently removes a diagram from the threat model",
        "operationId": "deleteThreatModelDiagram",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Diagram deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams/{diagram_id}/collaborate": {
      "get": {
        "tags": [
          "Collaboration"
        ],
        "summary": "Get diagram collaboration session",
        "description": "Retrieves the current collaboration session details for a diagram. The session payload indicates who has been authorized to the session, not who is currently active in the WebSocket session. The 200 status indicates successful retrieval - clients must NOT evaluate the payload to determine session status.",
        "operationId": "getDiagramCollaborationSession",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Collaboration session details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollaborationSession"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Collaboration"
        ],
        "summary": "Create diagram collaboration session",
        "description": "Creates a new collaboration session for real-time diagram editing. Only one collaboration session can exist per diagram at a time. If a session already exists, returns 409 with a link to join the existing session.",
        "operationId": "createDiagramCollaborationSession",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "201": {
            "description": "Collaboration session created successfully. The 201 status indicates successful creation - clients must NOT evaluate the payload to determine success.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollaborationSession"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "409": {
            "description": "Collaboration session already exists for this diagram",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "error",
                    "join_url"
                  ],
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "Error message indicating session already exists"
                    },
                    "join_url": {
                      "type": "string",
                      "description": "URL to join the existing collaboration session",
                      "example": "/threat_models/{threat_model_id}/diagrams/{diagram_id}/collaborate"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Collaboration"
        ],
        "summary": "Join diagram collaboration session",
        "description": "Joins an existing collaboration session for real-time diagram editing. The session must already exist.",
        "operationId": "joinDiagramCollaborationSession",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully joined collaboration session. The 200 status indicates successful join - clients must NOT evaluate the payload to determine success.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollaborationSession"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Collaboration"
        ],
        "summary": "End diagram collaboration session",
        "description": "Terminates the active collaboration session for a diagram",
        "operationId": "endDiagramCollaborationSession",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "204": {
            "description": "Collaboration session ended successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams/{diagram_id}/metadata": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get diagram metadata",
        "description": "Retrieves all metadata entries for the specified diagram",
        "operationId": "getDiagramMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "responses": {
          "200": {
            "description": "List of metadata entries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Create diagram metadata",
        "description": "Creates a new metadata entry for the specified diagram",
        "operationId": "createDiagramMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Metadata"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entry created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams/{diagram_id}/metadata/{key}": {
      "get": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Get diagram metadata by key",
        "description": "Retrieves a specific metadata entry for the diagram by key",
        "operationId": "getDiagramMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 256
            },
            "description": "Metadata key to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Metadata entry",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Update diagram metadata by key",
        "description": "Updates or creates a metadata entry for the diagram with the specified key",
        "operationId": "updateDiagramMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 256
            },
            "description": "Metadata key to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "string",
                    "maxLength": 1024,
                    "description": "Metadata value"
                  }
                },
                "required": [
                  "value"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Metadata entry updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Metadata"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Delete diagram metadata by key",
        "description": "Removes a specific metadata entry for the diagram by key",
        "operationId": "deleteDiagramMetadataByKey",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          },
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "maxLength": 256
            },
            "description": "Metadata key to delete"
          }
        ],
        "responses": {
          "204": {
            "description": "Metadata entry deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/threat_models/{threat_model_id}/diagrams/{diagram_id}/metadata/bulk": {
      "post": {
        "tags": [
          "Threat Model Sub-Resources"
        ],
        "summary": "Bulk create diagram metadata",
        "description": "Creates multiple metadata entries in a single operation for the specified diagram",
        "operationId": "bulkCreateDiagramMetadata",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "threat_model_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the threat model (UUID)"
          },
          {
            "name": "diagram_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid",
              "maxLength": 36
            },
            "description": "Unique identifier of the diagram (UUID)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Metadata"
                },
                "maxItems": 20
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Metadata entries created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Metadata"
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/Error"
          },
          "401": {
            "$ref": "#/components/responses/Error"
          },
          "403": {
            "$ref": "#/components/responses/Error"
          },
          "404": {
            "$ref": "#/components/responses/Error"
          },
          "500": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    }
  }
}