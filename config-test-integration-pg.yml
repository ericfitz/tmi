# TMI Integration Test Configuration - PostgreSQL
#
# This configuration is used for integration tests with PostgreSQL backend.
# Based on config-development.yml with test-appropriate adjustments.
#
# Usage: ./scripts/run-integration-tests-pg.sh
#

server:
  port: "8081"
  interface: localhost
  read_timeout: 5s
  write_timeout: 10s
  idle_timeout: 1m0s
  tls_enabled: false
  tls_cert_file: ""
  tls_key_file: ""
  tls_subject_name: localhost
  http_to_https_redirect: false

database:
  # DATABASE_URL (12-factor app pattern) - contains all connection parameters
  url: "postgres://tmi_dev:dev123@localhost:5433/tmi_dev?sslmode=disable"

  redis:
    host: localhost
    port: "6380"
    password: ""
    db: 1  # Use different DB for tests to avoid conflicts

auth:
  build_mode: test  # Test mode for TMI provider
  auto_promote_first_user: true
  jwt:
    secret: test-jwt-secret-do-not-use-in-production
    expiration_seconds: 300  # Shorter for tests
    signing_method: HS256
  oauth:
    callback_url: http://localhost:8081/oauth2/callback
    providers:
      tmi:
        id: tmi
        name: TMI Provider
        enabled: true
        icon: "/static/provider-logos/signin/tmi.svg"
        client_id: tmi-client-id
        client_secret: tmi-oauth-secret-12345
        authorization_url: http://localhost:8081/oauth2/authorize?idp=tmi
        token_url: http://localhost:8081/oauth2/token?idp=tmi
        userinfo: []
        issuer: tmi-oauth-provider
        jwks_url: "http://localhost:8081/.well-known/"
        scopes:
          - openid
          - profile
          - email
        additional_params: {}
  saml:
    enabled: false
    providers: {}

websocket:
  inactivity_timeout_seconds: 30  # Short timeout for tests

logging:
  level: debug
  is_dev: true
  is_test: true
  log_dir: logs/integration-test
  max_age_days: 1
  max_size_mb: 10
  max_backups: 3
  also_log_to_console: true
  log_api_requests: true
  log_api_responses: true
  log_websocket_messages: true
  redact_auth_tokens: true
  suppress_unauthenticated_logs: true

operator:
  name: "TMI Integration Tests"
  contact: "test@example.com"

administrators:
  - provider: "tmi"
    provider_id: "test-admin"
    email: "test-admin@tmi.local"
    subject_type: "user"
