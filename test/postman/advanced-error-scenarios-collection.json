{
  "info": {
    "name": "TMI Advanced Error Scenarios",
    "description": "Comprehensive error scenarios including 400, 404, 409, 422, and edge cases for threat models and all sub-resources",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token_alice}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://127.0.0.1:8080"
    },
    {
      "key": "oauthStubUrl",
      "value": "http://127.0.0.1:8079"
    },
    {
      "key": "testThreatModelId",
      "value": ""
    },
    {
      "key": "testDiagramId",
      "value": ""
    },
    {
      "key": "testThreatId",
      "value": ""
    },
    {
      "key": "nonExistentThreatModelId",
      "value": "00000000-0000-0000-0000-000000000000"
    },
    {
      "key": "nonExistentThreatId",
      "value": "00000000-0000-0000-0000-000000000001"
    },
    {
      "key": "nonExistentDiagramId",
      "value": "00000000-0000-0000-0000-000000000002"
    },
    {
      "key": "nonExistentDocumentId",
      "value": "00000000-0000-0000-0000-000000000003"
    },
    {
      "key": "nonExistentRepositoryId",
      "value": "00000000-0000-0000-0000-000000000004"
    },
    {
      "key": "nonExistentAssetId",
      "value": "00000000-0000-0000-0000-000000000005"
    },
    {
      "key": "nonExistentNoteId",
      "value": "00000000-0000-0000-0000-000000000006"
    }
  ],
  "item": [
    {
      "name": "Setup",
      "item": [
        {
          "name": "Create Test Threat Model",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Save threat model ID for error tests', function () {",
                  "    const responseData = pm.response.json();",
                  "    pm.expect(responseData).to.have.property('id');",
                  "    pm.collectionVariables.set('testThreatModelId', responseData.id);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Error Test TM\", \"description\": \"For error scenario testing\", \"threat_model_framework\": \"STRIDE\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models"
              ]
            }
          }
        },
        {
          "name": "Create Test Diagram",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Save diagram ID for error tests', function () {",
                  "    const responseData = pm.response.json();",
                  "    pm.expect(responseData).to.have.property('id');",
                  "    pm.collectionVariables.set('testDiagramId', responseData.id);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Error Test Diagram\", \"type\": \"DFD-1.0.0\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}",
                "diagrams"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Threat Models",
      "item": [
        {
          "name": "Create TM - Missing Required Name",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error indicates missing name', function () {",
                  "    const responseText = pm.response.text().toLowerCase();",
                  "    pm.expect(responseText).to.include('name');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name field\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models"]
            }
          }
        },
        {
          "name": "Create TM - Invalid JSON",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{invalid json syntax"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models"]
            }
          }
        },
        {
          "name": "Create TM - Invalid UUID Format",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/not-a-valid-uuid",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "not-a-valid-uuid"]
            }
          }
        },
        {
          "name": "Create TM - Empty Body",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Threats",
      "item": [
        {
          "name": "Create Threat - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name and severity\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats"]
            }
          }
        },
        {
          "name": "Create Threat - Invalid Severity",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Test Threat\", \"severity\": \"invalid-severity\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats"]
            }
          }
        },
        {
          "name": "Get Threat - Invalid UUID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats/invalid-uuid",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats", "invalid-uuid"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Diagrams",
      "item": [
        {
          "name": "Create Diagram - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name and type\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams"]
            }
          }
        },
        {
          "name": "Create Diagram - Invalid JSON",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{not valid json"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Documents",
      "item": [
        {
          "name": "Create Document - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/documents",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "documents"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Repositories",
      "item": [
        {
          "name": "Create Repository - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name and url\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/repositories",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "repositories"]
            }
          }
        },
        {
          "name": "Create Repository - Invalid URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Test Repo\", \"url\": \"not-a-valid-url\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/repositories",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "repositories"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Assets",
      "item": [
        {
          "name": "Create Asset - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"description\": \"Missing name\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/assets",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "assets"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Notes",
      "item": [
        {
          "name": "Create Note - Missing Required Fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"note_type\": \"general\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/notes",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "notes"]
            }
          }
        }
      ]
    },
    {
      "name": "400 Bad Request - Metadata",
      "item": [
        {
          "name": "Update Metadata - Invalid JSON",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{invalid json"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/metadata",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "metadata"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Threat Models",
      "item": [
        {
          "name": "Get Non-Existent Threat Model",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Error indicates not found', function () {",
                  "    const responseText = pm.response.text().toLowerCase();",
                  "    pm.expect(responseText).to.match(/(not found|does not exist)/);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}"]
            }
          }
        },
        {
          "name": "Update Non-Existent Threat Model",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Updated Name\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Threat Model",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Threats",
      "item": [
        {
          "name": "Get Non-Existent Threat",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats/{{nonExistentThreatId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats", "{{nonExistentThreatId}}"]
            }
          }
        },
        {
          "name": "Update Non-Existent Threat",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Updated Threat\", \"severity\": \"high\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats/{{nonExistentThreatId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats", "{{nonExistentThreatId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Threat",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/threats/{{nonExistentThreatId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "threats", "{{nonExistentThreatId}}"]
            }
          }
        },
        {
          "name": "Create Threat on Non-Existent TM",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"New Threat\", \"severity\": \"high\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}/threats",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}", "threats"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Diagrams",
      "item": [
        {
          "name": "Get Non-Existent Diagram",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{nonExistentDiagramId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams", "{{nonExistentDiagramId}}"]
            }
          }
        },
        {
          "name": "Update Non-Existent Diagram",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Updated Diagram\", \"type\": \"DFD-1.0.0\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{nonExistentDiagramId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams", "{{nonExistentDiagramId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Diagram",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{nonExistentDiagramId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams", "{{nonExistentDiagramId}}"]
            }
          }
        },
        {
          "name": "Start Collaboration on Non-Existent Diagram",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{nonExistentDiagramId}}/collaborate",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "diagrams", "{{nonExistentDiagramId}}", "collaborate"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Documents",
      "item": [
        {
          "name": "Get Non-Existent Document",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/documents/{{nonExistentDocumentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "documents", "{{nonExistentDocumentId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Document",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/documents/{{nonExistentDocumentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "documents", "{{nonExistentDocumentId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Repositories",
      "item": [
        {
          "name": "Get Non-Existent Repository",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/repositories/{{nonExistentRepositoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "repositories", "{{nonExistentRepositoryId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Repository",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/repositories/{{nonExistentRepositoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "repositories", "{{nonExistentRepositoryId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Assets",
      "item": [
        {
          "name": "Get Non-Existent Asset",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/assets/{{nonExistentAssetId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "assets", "{{nonExistentAssetId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Asset",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/assets/{{nonExistentAssetId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "assets", "{{nonExistentAssetId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Notes",
      "item": [
        {
          "name": "Get Non-Existent Note",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/notes/{{nonExistentNoteId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "notes", "{{nonExistentNoteId}}"]
            }
          }
        },
        {
          "name": "Delete Non-Existent Note",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/notes/{{nonExistentNoteId}}",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{testThreatModelId}}", "notes", "{{nonExistentNoteId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "404 Not Found - Metadata",
      "item": [
        {
          "name": "Get Metadata on Non-Existent TM",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}/metadata",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}", "metadata"]
            }
          }
        },
        {
          "name": "Update Metadata on Non-Existent TM",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\"custom_field\": \"value\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{nonExistentThreatModelId}}/metadata",
              "host": ["{{baseUrl}}"],
              "path": ["threat_models", "{{nonExistentThreatModelId}}", "metadata"]
            }
          }
        }
      ]
    },
    {
      "name": "422 Unprocessable Entity",
      "item": [
        {
          "name": "Invalid JSON Patch Operation (422)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json-patch+json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "[{\"op\": \"invalid-operation\", \"path\": \"/name\", \"value\": \"test\"}]"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 422 or 400', function () {",
                  "    pm.expect([422, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Error response indicates invalid operation', function () {",
                  "    const responseText = pm.response.text().toLowerCase();",
                  "    pm.expect(responseText).to.match(/(invalid|unsupported|unknown|bad)/);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "409 Conflict",
      "item": [
        {
          "name": "Start First Collaboration Session",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{testDiagramId}}/collaborate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}",
                "diagrams",
                "{{testDiagramId}}",
                "collaborate"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('First session created successfully', function () {",
                  "    pm.expect([200, 201]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response has session info', function () {",
                  "    if (pm.response.code === 200 || pm.response.code === 201) {",
                  "        const responseData = pm.response.json();",
                  "        pm.expect(responseData).to.have.property('websocket_url');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Duplicate Collaboration Session (Idempotent - Returns Existing)",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{testDiagramId}}/collaborate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}",
                "diagrams",
                "{{testDiagramId}}",
                "collaborate"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// API is idempotent - returns existing session on duplicate request",
                  "pm.test('Status code is 200 OK (idempotent)', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns existing session info', function () {",
                  "    const responseData = pm.response.json();",
                  "    pm.expect(responseData).to.have.property('websocket_url');",
                  "    pm.expect(responseData).to.have.property('diagram_id');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "End Collaboration Session",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}/diagrams/{{testDiagramId}}/collaborate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}",
                "diagrams",
                "{{testDiagramId}}",
                "collaborate"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Session ended successfully', function () {",
                  "    pm.expect([200, 204]).to.include(pm.response.code);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "500 Server Errors",
      "item": [
        {
          "name": "Large Payload Test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Large Payload Test\", \"description\": \"This is a large payload test with a very long description that repeats many times to test server handling of large requests. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. This is a large payload test with a very long description that repeats many times to test server handling of large requests. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\", \"threat_model_framework\": \"STRIDE\"}"
            },
            "url": {
              "raw": "{{baseUrl}}/threat_models",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is not 500', function () {",
                  "    pm.expect(pm.response.code).to.not.equal(500);",
                  "});",
                  "",
                  "pm.test('Server handles large payload gracefully', function () {",
                  "    pm.expect([200, 201, 400, 413]).to.include(pm.response.code);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Cleanup",
      "item": [
        {
          "name": "Delete Test Threat Model",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/threat_models/{{testThreatModelId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "threat_models",
                "{{testThreatModelId}}"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Cleanup successful', function () {",
                  "    // 409 can happen if collaboration session wasn't ended",
                  "    pm.expect([200, 204, 404, 409]).to.include(pm.response.code);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}