{
  "info": {
    "_postman_id": "tmi-unauthorized-tests",
    "name": "TMI API - Unauthorized Tests (401)",
    "description": "Tests that must run WITHOUT authentication to verify 401 responses. This collection runs BEFORE any authentication setup.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Explicitly unset any authentication tokens to ensure clean 401 tests",
          "pm.environment.unset('token_alice');",
          "pm.environment.unset('token_bob');",
          "pm.environment.unset('token_charlie');",
          "pm.environment.unset('token_diana');",
          "pm.environment.unset('access_token');",
          "",
          "pm.collectionVariables.unset('token_alice');",
          "pm.collectionVariables.unset('token_bob');",
          "pm.collectionVariables.unset('token_charlie');",
          "pm.collectionVariables.unset('token_diana');",
          "pm.collectionVariables.unset('access_token');",
          "",
          "console.log('\ud83d\udd12 All authentication tokens cleared for 401 testing');"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Create Threat Model - Unauthorized (401)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// Generate valid threat model data",
              "const threatModel = {",
              "    name: `Unauthorized Test Threat Model ${Date.now()}`,",
              "    description: 'This should be rejected due to lack of authentication',",
              "    threat_model_framework: 'STRIDE'",
              "};",
              "",
              "pm.collectionVariables.set('threatModelData', JSON.stringify(threatModel));"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{threatModelData}}"
        },
        "url": {
          "raw": "{{baseUrl}}/threat_models",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models"
          ]
        },
        "description": "Test threat model creation without authentication"
      }
    },
    {
      "name": "List Threat Models - Unauthorized (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/threat_models",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models"
          ]
        },
        "description": "Test threat models listing without authentication"
      }
    },
    {
      "name": "Get Threat Model - Unauthorized (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/threat_models/00000000-0000-0000-0000-000000000000",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models",
            "00000000-0000-0000-0000-000000000000"
          ]
        },
        "description": "Test threat model retrieval without authentication"
      }
    },
    {
      "name": "Update Threat Model - Unauthorized (401)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// Generate update data",
              "const updatedThreatModel = {",
              "    name: `Unauthorized Update ${Date.now()}`,",
              "    description: 'This should be rejected due to lack of authentication',",
              "    threat_model_framework: 'PASTA'",
              "};",
              "",
              "pm.collectionVariables.set('updatedThreatModelData', JSON.stringify(updatedThreatModel));"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{updatedThreatModelData}}"
        },
        "url": {
          "raw": "{{baseUrl}}/threat_models/00000000-0000-0000-0000-000000000000",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models",
            "00000000-0000-0000-0000-000000000000"
          ]
        },
        "description": "Test threat model update without authentication"
      }
    },
    {
      "name": "Patch Threat Model - Unauthorized (401)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// Generate JSON patch operations",
              "const patchOps = [",
              "    {",
              "        op: 'replace',",
              "        path: '/description',",
              "        value: 'Unauthorized patch attempt'",
              "    }",
              "];",
              "",
              "pm.collectionVariables.set('patchOps', JSON.stringify(patchOps));"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json-patch+json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{patchOps}}"
        },
        "url": {
          "raw": "{{baseUrl}}/threat_models/00000000-0000-0000-0000-000000000000",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models",
            "00000000-0000-0000-0000-000000000000"
          ]
        },
        "description": "Test threat model patch without authentication"
      }
    },
    {
      "name": "Delete Threat Model - Unauthorized (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 401', function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test('Error indicates authentication required', function () {",
              "    const responseData = pm.response.json();",
              "    pm.expect(responseData.error).to.exist;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/threat_models/00000000-0000-0000-0000-000000000000",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "threat_models",
            "00000000-0000-0000-0000-000000000000"
          ]
        },
        "description": "Test threat model deletion without authentication"
      }
    }
  ]
}